<!DOCTYPE html>
<html>
<head>
    <title>Next Race</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="../fetchdata.js"></script>
    <script>
        const socket = io();

        function min(x, y) {
            if (x < y) {
                return x
            } else {
                return y
            }
        }

        function generateDrivers() {

        }

        async function getNextRace() {

            races = await getRacesInDB();

            console.log(races);

            if (!races || races.length == 0) {return -1};

            nextRace = races[0].id;
            for (const row of races) {
                nextRace = min(nextRace, row.id);
            }

            return nextRace

        }

        

        socket.on('connect', () => {
            console.log('Connected to server');
        });


        socket.on('update:nextRace', (race) => {
            const nextRaceDiv = document.getElementById('next-race');
            if (race) {
                nextRaceDiv.innerHTML = `
                    <h2>Next Race: ${race.id}</h2>
                    <ul>
                        ${race.drivers.map(driver => `<li>${driver.name} - Car ${driver.car}</li>`).join('')}
                    </ul>
                `;
            } else {
                nextRaceDiv.innerHTML = '<h2>No races in queue</h2>';
            }
        });

        nextRace = getNextRace();

        let drivers;

        if (nextRace != -1) {
            drivers = getDriversInDB(nextRace)
        }

        document.addEventListener('DOMContentLoaded', () => {
        
        if (drivers) {
            generateDrivers();
        } else {

            const noRaces = document.createElement('div');
            noRaces.id = 'next-race';
            const message = document.createElement('h2');
            message.textContent = 'No races in queue'
            noRaces.appendChild(message);
            document.body.appendChild(noRaces);

        }

        });
    </script>
</head>
<body>
</body>
</html>
