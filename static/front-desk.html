<!DOCTYPE html>
<html>

<head>
    <script>
        class Driver {
            constructor(name, car) {
                this.name = name;
                this.car = car;
            }
        }
        class Race {
            constructor(id) {
                this.id = id;
                this.drivers = [];
                this.availableCars =
                    [8, 7, 6, 5, 4, 3, 2, 1];
            }

            get getDrivers() {
                return this.drivers;
            }

            addDriver(name, car = null) {
                if (this.availableCars.length === 0) {
                    return {error: true, code: 'capacity'}
                }
                const matchingDriver = this.drivers.filter((driver) => driver.name === name);
                if (matchingDriver.length > 0) {
                    return {error: true, code: 'name'};
                }
                const matchingCar = this.drivers.filter((driver) => driver.car === car);
                if (matchingCar.length > 0) {
                    return {error: true, code: 'car'};
                }
                if (car === null ) {
                    car = this.availableCars.pop();
                }
                const newDriver = new Driver(name, car);
                this.drivers.push(newDriver);

                return {error: false, code: null};
            }

            removeDriver(name) {
                const currentLength = this.drivers.length;
                this.drivers = this.drivers.filter((driver) => {
                    if (driver.name === name) {
                        this.availableCars.push(driver.car);
                        return true;
                    }
                    return false;
                });
                return this.drivers.length !== currentLength;
            }
        }



        document.addEventListener("DOMContentLoaded", () => {
            let races = [];
            let idCounter = 1;

            function createRace() {
                const race = new Race(idCounter);
                races.push(race);
                idCounter++;

                const raceDiv = document.createElement('div');
                raceDiv.className = 'race';
                raceDiv.id = `race-${race.id}`;

                const raceTitle = document.createElement('h2');
                raceTitle.textContent = `Race ${race.id}`;
                raceDiv.appendChild(raceTitle);

                const addDriverForm = document.createElement('form');
                addDriverForm.innerHTML = `
                    <input type="text" placeholder="Driver Name" id="driver-name-${race.id}">
                    <button type="submit">Add Driver</button>
                `;
                addDriverForm.onsubmit = (e) => {
                    e.preventDefault();
                    const driverName = document.getElementById(`driver-name-${race.id}`).value;
                    const result = race.addDriver(driverName);
                    if (!result.error) {
                        updateRaceDisplay(race);
                    } else {
                        let message = '';
                        switch(result.code) {
                            case 'capacity':
                                message = 'maximum number of drivers (8) exceeded';
                                break;
                            case 'name':
                                message = 'driver name already taken';
                                break;
                            default:
                                message = 'car number already taken';
                        }

                        alert(`Error ${message}`);
                    }
                };
                raceDiv.appendChild(addDriverForm);

                
            }

            function updateAddRaceDiv(raceDiv) {
               document.getElementById('add-race');

            }

            function updateRaceDisplay(race) {
                const raceDiv = document.getElementById(`race-${race.id}`);
                const existingDriver = raceDiv.querySelectorAll('.driver');
                existingDriver.forEach((driver) => driver.remove());

                race.getDrivers.forEach((driver) => {
                    const driverDiv = document.createElement('div');
                    driverDiv.className = 'driver';
                    driverDiv.textContent = `${driver.name} - Car ${driver.car}`;
                    raceDiv.appendChild(driverDiv);
                });
            }

            const addRaceDiv = document.createElement('div');
            addRaceDiv.className = 'race';
            addRaceDiv.id = 'add-race';
            
            const addRaceButton = document.createElement('button');
            addRaceButton.textContent = 'Add New Race';
            addRaceButton.id = 'add-race-button';
            addRaceButton.onclick = createRace;
            addRaceDiv.appendChild(addRaceButton);

            document.body.appendChild(addRaceDiv);

            
        });
    </script>
    <style>
        body {
            display: flex;
            margin: 0;
            padding: 20px;
            width: 100vw;
            min-height: 100vh;
            flex-wrap: wrap;
            box-sizing: border-box;
        }
        .race {
            display: flex;
            flex-direction: column;
            width: 25vw;
            min-height: 50vh;
            border: 1px solid #ccc;
            margin: 10px;
            padding: 10px;
        }
        .driver {
            width: 100%;
            margin: 5px 0;
            padding: 5px;
            background-color: #f0f0f0;
        }
    </style>
</head>

<body>

</body>

</html>